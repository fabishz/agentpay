{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/fabrice/Desktop/hackathons/agentpay-gateway/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst prismaClientSingleton = () => {\n    return new PrismaClient();\n};\n\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>;\n\nconst globalForPrisma = globalThis as unknown as {\n    prisma: PrismaClientSingleton | undefined;\n};\n\nexport const prisma = globalForPrisma.prisma ?? prismaClientSingleton();\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,6NAAY;AAC3B;AAIA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///home/fabrice/Desktop/hackathons/agentpay-gateway/src/app/api/analytics/revenue/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET() {\n    try {\n        // Get transactions from the last 7 days\n        const sevenDaysAgo = new Date();\n        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n\n        const transactions = await prisma.transaction.findMany({\n            where: {\n                createdAt: {\n                    gte: sevenDaysAgo,\n                },\n                status: 'success',\n            },\n            select: {\n                amount: true,\n                createdAt: true,\n            },\n        });\n\n        // Group transactions by day\n        const revenueByDay = new Map<string, { revenue: number; payments: number }>();\n\n        // Initialize last 7 days\n        for (let i = 6; i >= 0; i--) {\n            const date = new Date();\n            date.setDate(date.getDate() - i);\n            const dateKey = date.toLocaleDateString('en-US', { weekday: 'short' });\n            const fullDateKey = date.toISOString().split('T')[0];\n            revenueByDay.set(fullDateKey, { revenue: 0, payments: 0 });\n        }\n\n        // Aggregate transactions\n        transactions.forEach((tx) => {\n            const dateKey = tx.createdAt.toISOString().split('T')[0];\n            const existing = revenueByDay.get(dateKey);\n            if (existing) {\n                existing.revenue += tx.amount;\n                existing.payments += 1;\n            }\n        });\n\n        // Format for chart\n        const chartData = [];\n        for (let i = 6; i >= 0; i--) {\n            const date = new Date();\n            date.setDate(date.getDate() - i);\n            const dateKey = date.toISOString().split('T')[0];\n            const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });\n            const data = revenueByDay.get(dateKey) || { revenue: 0, payments: 0 };\n\n            chartData.push({\n                date: dayName,\n                revenue: Math.round(data.revenue * 100) / 100,\n                payments: data.payments,\n            });\n        }\n\n        return NextResponse.json(chartData);\n    } catch (error) {\n        console.error('Revenue analytics error:', error);\n        return NextResponse.json({ error: 'Failed to fetch revenue data' }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IAClB,IAAI;QACA,wCAAwC;QACxC,MAAM,eAAe,IAAI;QACzB,aAAa,OAAO,CAAC,aAAa,OAAO,KAAK;QAE9C,MAAM,eAAe,MAAM,uJAAM,CAAC,WAAW,CAAC,QAAQ,CAAC;YACnD,OAAO;gBACH,WAAW;oBACP,KAAK;gBACT;gBACA,QAAQ;YACZ;YACA,QAAQ;gBACJ,QAAQ;gBACR,WAAW;YACf;QACJ;QAEA,4BAA4B;QAC5B,MAAM,eAAe,IAAI;QAEzB,yBAAyB;QACzB,IAAK,IAAI,IAAI,GAAG,KAAK,GAAG,IAAK;YACzB,MAAM,OAAO,IAAI;YACjB,KAAK,OAAO,CAAC,KAAK,OAAO,KAAK;YAC9B,MAAM,UAAU,KAAK,kBAAkB,CAAC,SAAS;gBAAE,SAAS;YAAQ;YACpE,MAAM,cAAc,KAAK,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;YACpD,aAAa,GAAG,CAAC,aAAa;gBAAE,SAAS;gBAAG,UAAU;YAAE;QAC5D;QAEA,yBAAyB;QACzB,aAAa,OAAO,CAAC,CAAC;YAClB,MAAM,UAAU,GAAG,SAAS,CAAC,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;YACxD,MAAM,WAAW,aAAa,GAAG,CAAC;YAClC,IAAI,UAAU;gBACV,SAAS,OAAO,IAAI,GAAG,MAAM;gBAC7B,SAAS,QAAQ,IAAI;YACzB;QACJ;QAEA,mBAAmB;QACnB,MAAM,YAAY,EAAE;QACpB,IAAK,IAAI,IAAI,GAAG,KAAK,GAAG,IAAK;YACzB,MAAM,OAAO,IAAI;YACjB,KAAK,OAAO,CAAC,KAAK,OAAO,KAAK;YAC9B,MAAM,UAAU,KAAK,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;YAChD,MAAM,UAAU,KAAK,kBAAkB,CAAC,SAAS;gBAAE,SAAS;YAAQ;YACpE,MAAM,OAAO,aAAa,GAAG,CAAC,YAAY;gBAAE,SAAS;gBAAG,UAAU;YAAE;YAEpE,UAAU,IAAI,CAAC;gBACX,MAAM;gBACN,SAAS,KAAK,KAAK,CAAC,KAAK,OAAO,GAAG,OAAO;gBAC1C,UAAU,KAAK,QAAQ;YAC3B;QACJ;QAEA,OAAO,uKAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,uKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA+B,GAAG;YAAE,QAAQ;QAAI;IACtF;AACJ"}}]
}